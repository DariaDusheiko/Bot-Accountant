{% extends "layout.html" %}

{% block title %}welcome{% endblock title %}

{% block content %}

    <span>Add new transaction</span>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <ul>
                {% for category, message in messages %}
                    <li class="flash flash-{{ category }}">{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}

    <div class="container" >
        <form class="transaction-form" method="post" action="/transactions">
                <div class="amount">
                    <input type="number" value="{{ transaction.get('amount', '') }}" id="amount" name="amount" placeholder="Enter the amount" onInput="this.style.color='white';" onBlur="this.style.color='white';" required>
                </div>
                <div class="type">
                    <select id="type" name="type" required>
                        <!-- <option value="">Select type</option> -->
                        <option value="expense">Expense</option>
                        <option value="income">Income</option>
                    </select>
                </div>
                <div class="category">
                    <select id="category" name="category" required>
                        <!-- <option value="">Select category</option> -->
                        <option value="food">food</option>
                        <option value="transportation">transportation</option>
                        <option value="utilities">utilities</option>
                        <option value="entertainment">entertainment</option>
                        <option value="other">other</option>
                    </select>
                </div>
                <div class="date">
                    <input type="date" id="date" name="date" onInput="this.style.color='white';" onBlur="this.style.color='white';" required>
                </div>
                <div class="description">
                    <textarea id="description" name="description" rows="4" placeholder="Enter description" value="{{ transaction.get('description', '') }}" onInput="this.style.color='white';" onBlur="this.style.color='white';" required></textarea>
                </div>
                <!-- <button type="button" onclick="addTransactionToTable()">Add</button> -->
                <button type="submit">Add</button>
            </div>
            <table id="transactionTable">
                <thead>
                    <tr>
                        <th>Amount</th>
                        <th>Type</th>
                        <th>Category</th>
                        <th>Date</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </form>
    </div>
    
    
    {% if error %}
        {{ error }}
    {% endif %}

    <script>
        function addTransactionToTable() {
            const amount = document.getElementById('amount').value;
            const type = document.getElementById('type').value;
            const category = document.getElementById('category').value;
            const date = document.getElementById('date').value;
            const description = document.getElementById('description').value;
        
            if (amount && type && category && date && description) {
                const table = document.getElementById('transactionTable');
                const newRow = table.insertRow(-1);
        
                const amountCell = newRow.insertCell(0);
                const typeCell = newRow.insertCell(1);
                const categoryCell = newRow.insertCell(2);
                const dateCell = newRow.insertCell(3);
                const descriptionCell = newRow.insertCell(4);
        
                amountCell.textContent = amount;
                typeCell.textContent = type;
                categoryCell.textContent = category;
                dateCell.textContent = date;
                descriptionCell.textContent = description;
        
                document.getElementById('amount').value = '';
                document.getElementById('type').value = '';
                document.getElementById('category').value = '';
                document.getElementById('date').value = '';
                document.getElementById('description').value = '';
        }
    }

    function updateSecondSelector() {            // Получаем выбранное значение первого селектора
            const firstSelector = document.getElementById('type');            
            const selectedValue = firstSelector.value;
            // Получаем второй селектор
            const secondSelector = document.getElementById('category');
            // Очищаем второй селектор            
            secondSelector.innerHTML = '';
            // В зависимости от выбранного значения заполняем второй селектор
            let options = [];
            if (selectedValue === 'expense') {               
                options = ['food', 'transportation', 'utilities', 'entertainment', 'other'];
            } else {
                options = ['salary', 'award', 'gift', 'other'];            
            }
            // Добавляем новые опции в второй селектор
            options.forEach(option => {                const newOption = document.createElement('option');
                newOption.value = option;                newOption.textContent = option;
                secondSelector.appendChild(newOption);            });
        }
        // Добавляем обработчик события для первого селектора        
        window.onload = function() {
            document.getElementById('type').addEventListener('change', updateSecondSelector);        };
    </script>


{% endblock content %}
