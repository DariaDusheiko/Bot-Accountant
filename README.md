
<p align="center">
   <strong>Федеральное государственное автономное образовательное учреждение
высшего образования 
"Национальный исследовательский университет 
"Высшая школа экономики"

</strong>
<br>
Московский институт электроники и математики им. А.Н. Тихонова НИУ ВШЭ
Департамент компьютерной инженерии 
</p>

<br>

<p align="center"><strong>Курс</strong>: <i>Python в науке о данных</i></p>

<p align="center">Веб-приложение для учета финансов <strong>"MONAI"</strong></p>
<br><br><br><br>
<p align="right"><i>Научный руководитель:</i><br>Ролич Алексей Юрьевич<br><br><i>Проект выполнили:</i><br>Студенты <strong>БИВ237</strong><br>Душейко Дарья Васильевна<br>Непорожнев Всеволод Васильевич<br>Пустовой Георгий Юрьевич</p>

<p align="center"><i>Москва, 2024</i></p>
<br><br>

# Документация разработчика

## Установка и запуск проекта
Ниже представлен алгоритм по сборке и запуску проекта локально для операционных систем `Windows` и `Linux`
1. Клонируйте репозиторий с GitHub
2. Перейдите в папку с проектом
```shell
cd /путь/до/BOT-ACCOUNTANT
```
3. Установите виртуальное окружение
```shell
# Windows
python -m venv venv
# Unix
python3 -m venv env
```
4. Активируйте виртуальное окружение
```shell
# Windows
venv/Scripts/activate
#Unix
source env/bin/activate
```
5. Создайте конфигурационный файл .env и добавьте
```shell
# Windows
echo. > .env
# Unix
touch .env
```
```.env
SECRET_KEY=<Ваш секретный ключ>
```
6. Загрузите зависимости
```shell
pip install -r requirements.txt
```
7. Запустите проект
```shell
# Windows
python -m run
# Unix - любая из двух
python3 -m run 
make run
```
## Иерархия файлов

```txt
MONAI
├── app
│   ├── analytics
│   │   ├── analytics.py
│   │   ├── model.py
│   │   └── utils
│   │       ├── check_enough_data_for_analytics.py
│   │       ├── __init__.py
│   │       └──process_prediction_data.py
│   ├── csvy
│   │   ├── akks.csv
│   │   ├── end.csv
│   │   ├── goal.csv
│   │   ├── test.csv
│   │   └── trans.csv
│   ├── data_of_entering.py
│   ├── data_of_goal.py
│   ├── data_of_transaction.py
│   ├── __init__.py
│   ├── models.py
│   ├── routes.py
│   ├── static
│   │   ├── imgs
│   │   │   ├── analytics.svg
│   │   │   ├── buget.svg
│   │   │   ├── celendar.svg
│   │   │   ├── Group.svg
│   │   │   ├── logo.svg
│   │   │   └── tommy.png
│   │   └── styles
│   │       └── main.css
│   ├── templates
│   │   ├── analytics_page.html
│   │   ├── auth_page.html
│   │   ├── error.html
│   │   ├── goal_page.html
│   │   ├── layout.html
│   │   ├── main_page.html
│   │   ├── not_enough_data_for_anaytics.html
│   │   └── transactions_page.html
│   ├── test
│   │   ├── test_1.py
│   │   └── test.py
│   └── utils
│       ├── hash_password.py
│       ├── names.py
│       ├── process_form_data.py
│       └── validator.py
├── env
├── Makefile
├── README.md
├── requirements.txt
└── run.py
```
## UML-диаграммы

- Диаграмма активности приложения

![Диаграмма активности](https://i.ibb.co/KNKqxdS/activity-chart.png)

- Диаграмма устройства баз данных

![Диаграмма классов БД](https://i.ibb.co/mbWJHhK/database-structure.png)

## Описание функций

## `app/routes.py`
```python
"""
    app/routes.py
    Декораторы описывают эндпоинты (и опционально методы), к которым привязаны функции
    Глобально в этом файле есть доступ к сущности session.

    В случае, если в данных пользователя нет в session, выполняе редирект на страница входа/регистрации.
    При попытке открыть страницу регистрации/входа, иначе, выполняем редирект на главную страницу.
"""

```
<br>

#### `main()`
```python
@app.route('/')
def main() -> Union[Response, str]:
    """
    Если пользователь не вошел в сессию, перенаправляем на функцию входа/регистрации
    Иначе получаем индекс пользователя из сессии и отдаем  main_page.html с данными пользователя
    """
    pass
```

### `show_aut()`
```python
@app.get('/auth')
def show_auth() -> Union[Response, str]:
    """
    Отдача шаблона показа формы регистрации auth_page.html
    """
    pass
```

### `do_auth()`
```python
@app.post('/auth')
def do_auth() -> Union[Response, str]:
    """
    Обработка данных из форм.
    Если в пользовательских данных есть поле password_confirmation, то находимся на этапе регистрации.
    Тогда проверяем данные регистрации на валидность. Если данные валидны, добавляем пользователя в БД.
    Далее шаги одинаковые и для регистрации и для входа - добавляем в сессию данные пользователя.
    Если на этапе валидации или входа возвращаемся на страницу входа, отображая ошибку
    """
    pass
```

### `analytics()`
```python
@app.route('/analytics')
def analytics() -> Union[Response, str]:
    """
    Если данных пользователя достаточно для построения аналитики - отрисовываем их и отдаем вместе с шаблоном analytics_page.html
    Иначе возвращаем параметр, которого не хвататет для построения в ошибке, вместе с шаблоном not_enough_data_for_analytics.html
    """
    pass
```

### `show_transactions()`
```python
@app.get('/transactions')
def show_transaction() -> Union[Response, str]:
    """
    Страница отображения формы с добавлением транзакции шаблона transactions_page.html 
    """
    pass
```

### `make_transaction()`
```python
@app.post('/transactions')
def make_transaction() -> Union[Response, str]:
    """
    Обработка данных из форм.
    Если данные валидны, добавляем в бд, иначе, возвращаем выполняем редирект на show_transaction() с соответствующей ошибкой
    """
    pass
```

### `show_goal()`
```python
@app.get('/goal')
def show_goal() -> Union[Response, str]:
    """
    Страница отображения формы с добавлением/обновлением цели из шаблона goal_page.html
    """
    pass
```

### `add_to_goal()`

```python
@app.post('/goal')
def add_to_goal() -> Union[Response, str]:
    """
    Совершние перевода между основным аккаунтом и копилкой, если нет противоречия (недостаточно средств на основном аккаунте или в копилке)
    """
    pass
```

### `new_goal()`

```python
@app.post('/goal-new')
def new_goal() -> Union[Response, str]:
    """
    Обновление цель
    """
    pass
```

### `exit()`

```python
@app.get('/exit')
def exitt():
    """
    Очистка данных сессии
    """
    pass
```

## `app/utils`

### `.../hash_password.py`
### `hash_password()`
```python
def hash_password(password : str) -> str:
    """
    Функция возвращает хэшированный пароль
    """
    pass
```
<br>

### `.../process_form_data.py`
### `process_form_data()`
```python
def process_form_data(user : Dict[str, str]) -> Dict[str, str]:
    """
    Функция возвращает очищенные от символов пустого пространства данные полей
    """
    pass
```
<br>

### `.../validate.py`
### `validate()`
```python
def validate(user : Dict[str, str]) -> str:
    """
    Функция валидирует поля usrname, password, password_confirmation, в случае несоответствия ожидаемым значениям возвращает соответствующую ошибку
    """
    pass
```

## `app/analytics`

### `.../model.py`
### `predict()`
```python
def predict(inde : UUID, type : Enum) -> str:
    """
    Функция предсказания расходов/доходов.
    Строит диаграмму на основе данных пользователя из датафрейма, а так же предсказанных данных. 
    Возвращает html-представление строки диаграммы, встраиваемой в шаблон.
    """
    pass
```
### `predict_cumulative()`
```python
def predict_cumulative(inde : UUID, type : Enum) -> str:
    """
    Функция предсказания кумулятивных единиц - бюджета/копилки.
    Строит диаграмму на основе данных пользователя из датафрейма, а так же предсказанных данных. 
    Возвращает html-представление строки диаграммы, встраиваемой в шаблон.
    """
    pass
```

### `utils/check_enough_data.py`
### `check_enough_data_for_analytics.py`
```python
def check_enough_data_for_analytics(inde : UUID) -> tuple(bool, str):
    """
    Функция для проверки достаточности данных для аналитики.
    В случае, если одно из необходимых условий не выполняется, возвращается соответствующее сообщение о том, чего не хватает.
    """
    pass
```
### `utils/process_prediciton_data`
### `process_prediction_data.py`
```python
def process_goal_prediction(date_str : str) -> str:
    """
    На основе ожидаемой даты достижения цели формируется соотвующее сообщение 
    Если динамика роста отрицательная или не ожидается, что цель будет достигнута в ближайший год, возвращается соответствующее сообщение.
    """
    pass
```
- Описание классов

## `app/data_of_entering.py`
```python
"""
    В файле идет обращение к базе данных app/csvy/akks.csv и ее обработка.
"""

```
<br>

#### `class Data_enter`
```python
class Data_enter:
    def server():
        """
        Создание базы данных с пользователями.
        """
        pass

    def done_registration(login_acc : str, password_acc : str):
        """
        Добавление новой записи, нового пользователя.
        """
        pass

    def enter_acc(login_acc : str, password_acc : str) -> str:
        """
        Проверка совпадения данных при входе с базой данных.
        """
        pass

    def change_data(inde : int, what_change : str, for_change : str, flag : int) -> str:
        """
        изменение данных в определенной ячейке.
        """
        pass

    def del_akk(inde : int):
        """
        Удаление строки в базе данных, информацию о пользоввателе.
        """
        pass

    def info_user(inde : int) -> list[str, int, int]:
        """
        Получение значений из базы данных, информации о пользователе.
        """
        pass
```


## `app/data_of_goal.py`
```python
"""
    В файле идет обращение к базе данных app/csvy/goal.csv и ее обработка.
"""

```
<br>


#### `class Data_goal`
```python
class Data_goal:
    def server():
        """
        Создание базы данных с информацией о транзакциях цели.
        """
        pass

    def add_goal(inde : int, user_amount : int, user_type : str) -> str:
        """
        Добавление новой записи, транзакции цели.
        """
        pass
        
    def type_information(inde : int) -> tuple(int, list):
        """
        Получение остатка на счете пользоваетля в пределенную дату.
        """
        pass

    def my_cash(inde : int) -> int:
        """
        Получение остатка на счете пользоваетля сейчас.
        """
        pass

    def del_transaction(inde : int):
        """
        Удаление строки в базе данных, информацию о транзакциях пользоввателя.
        """
        pass

    def time_ago(inde : int, days_1 : datatime, type_trans : str, categories : list[str]) -> int:
        """
        Получение суммы расоходов или доходов за определенное время.
        """
        pass

```

## `app/data_of_transaction.py`
```python
"""
    В файле идет обращение к базе данных app/csvy/trans.csv и ее обработка.
"""

```
<br>


#### `class Data_trans`
```python
class Data_trans:
    def server():
        """
        Создание базы данных с информацией о транзакциях пользователя.
        """
        pass

    def add_transaction(inde : int, user_amount : int, user_type : str, user_category : str, user_description : str, user_date : datetime) -> str:
        """
        Добавление новой записи транзакции.
        """
        pass
        
    def type_summ(inde : int, user_type : str) -> int:
        """
        Получение суммы расходов или доходов пользователя.
        """
        pass

    def my_cash(inde : int) -> int:
        """
        Получение остатка на счете пользоваетля сейчас.
        """
        pass

    def count_of_category(inde : int):
        """
        Получение количества транзакций, связанных с определенной категорией, 
        """
        pass

    def category_out(inde : int, days_1 : datatime, type : str) -> list[list[str, int]]:
        """
        Получение расходов или доходов пользователя на категории.
        """
        pass

    def sum_for_month(inde : int, month : int, type : str) -> int:
        """
        Получение суммы расходы или дохода за определенное количество месяцев..
        """
        pass

    def del_transaction(inde : int):
        """
        Удаление строки в базе данных, информацию о транзакциях пользоввателя.
        """
        pass

    def time_ago(inde : int, days_1 : datatime, type_trans : str, categories : list[str]) -> int:
        """
        Получение суммы расоходов или доходов на определенные категории.
        """
        pass
```

## Тестирование 
В процессе разработки производились регулярые модульные тестирования.<br>
По окончании создания приложения было проведено комплексное тестирование всех частей программы, которое включило в себя:
1. Тестирование различных сценариев взаимодействия пользователя с приложением с учетом того, что пользователь действует по инструкции и не допускает ошибок при работе с приложением
2. Тестирование системы на неожиднные и несоответствующие инструкции сценарии взаимодействия с пользователем. В том числе:
- Невалидные данные форм (неподходящие данные для входа и регистрации, пустые поля, отрицательные суммы, прошедшие даты и даты далекого будущего, несоответствующие типы)
- Невозможные действия с балансом "бюджета" и "копилки"
- Неразрешенные методы HTTP-запросов
3. Стресс-тестирование и нагрузочное тестирования не проводились, но должны быть проведены при увеличении постоянного онлайна на сайте

В результате проведенного тестирования были выявлены и устранены функциональные ошибки, а также ускорена работа приложения благодаря оптимизации кода.

## Результаты работы

В данном разделе представлены результаты выполнения различных действий на странице в виде частного сценария использования. Для каждого действия приведены скриншоты, которые демонстрируют изменения и функциональные возможности приложения.



#### Страница аутентификации :: вход
![Вход](https://i.ibb.co/N9PSBh5/image-2024-06-20-22-57-11.png)
#### Страница аутентификации :: регистрация
![Регистрация](https://i.ibb.co/p3yDdDT/image-2024-06-20-22-58-54.png)
#### Страница аутентификации :: ошибка при входе
![Ошибка при входе](https://i.ibb.co/1XZT1Yj/image.png)
#### Страница аутентификации :: ошибка при регистрации
![Ошибка при регистрации](https://i.ibb.co/hdHVfqT/image-2024-06-03-21-17-33.png)
#### Главная страница :: цель не достигнута
![Главная страница](https://i.ibb.co/Yh4F1vs/image.png)
#### Главная страница :: цель достигнута
![Главная страница - цель достигнута](https://i.ibb.co/2M92kK2/image.png)
#### Страница транзакций :: поля заполнены
![Страница транзакций](https://i.ibb.co/TwXhR2v/image.png)
#### Страница транзакций :: транзакция добавлена
![Транзакция добавлена](https://i.ibb.co/qdm3dDg/image.png)
#### Страница цели :: добавление транзакции на цель
![Страница цели - добавление](https://i.ibb.co/M5tHsSn/image.png)
#### Страница цели :: обновление цели
![Страница цели - обновление](https://i.ibb.co/59kTc85/image.png)
#### Страница цели :: ошибка при попытке обновить цель
![Ошибка при добавлении на цель](https://i.ibb.co/PhhJ4px/image.png)
#### Страница аналитики :: недостаточно данных для аналитики
![Недостаточно данных для аналитики](https://i.ibb.co/zQpXF42/image.png)
#### Страница аналитики
![Страница аналитики](https://i.ibb.co/512B6rb/image.png)
![Страница аналитики](https://i.ibb.co/qR12M70/image.png)
![Страница аналитики](https://i.ibb.co/Qk3F3D1/image.png)
![Страница аналитики](https://i.ibb.co/XSDYCq8/image.png)
![Страница аналитики](https://i.ibb.co/3zVDYMw/image.png)


## Требования к среде, в рамках которой будет работать разработанное ПО

Для запуска данного проекта необходимо:

- Python версии 3.8 или выше
- Установленные зависимости, указанные в файле `requirements.txt`

# Руководство пользователя

## Установка и запуск проекта
Ниже представлен алгоритм по сборке и запуску проекта локально для операционных систем `Windows` и `Linux`
1. Убедитесь, что на вашем устройстве установлен Python версии `3.8` и выше. Подробнее [тут](https://www.python.org)
2. Клонируйте репозиторий с GitHub
```bash
git clone https://github.com/vivatttt/Bot-Accountant.git
```
3. Перейдите в папку с проектом
```shell
cd /путь/до/BOT-ACCOUNTANT
```
4. Установите виртуальное окружение
```shell
# Windows
python -m venv venv
# Unix
python3 -m venv env
```
5. Активируйте виртуальное окружение
```shell
# Windows
venv/Scripts/activate
#Unix
source env/bin/activate
```
6. Создайте конфигурационный файл .env и добавьте секретный ключ.
Его можно придумать самостоятельно или сгенерировать, главное - никому не показывать
```shell
# Windows
echo. > .env
# Unix
touch .env
```
```.env
SECRET_KEY=<Ваш секретный ключ>
```
7. Загрузите зависимости
```shell
pip install -r requirements.txt
```
8. Запустите проект
```shell
# Windows
python -m run
# Unix - любая из двух
python3 -m run 
make run
```
9. Перейдите на
```http
http://127.0.0.1:8000/
```
## Описание функционала и пользовательского взаимодействия с приложением
1) Зарегистрируйтесь в системе (придумайте логин и пароль) запомните их!
2) После регистрации вы попадаете на главный экран, по сколько вы новый пользователь, тут ничего не отображено
4) В верхнем меню выберите и нажмите вкладку "transactions". Вы попадёте на страницу с добавлением транзакций.
5) Заполните ВСЕ поля, перенесите все свои расходы и доходы за как можно больший промежуток времени.
6) Добавленные транзакции отображаются в таблице ниже.
7) Перейдите на вкладку "analytics" Если данных недостаточно вам будет отображено сообщение с указанием действия , заполненную страницу аналитики можно посмотреть в пунктах(11-17). В данном же примере нам нужно установить цель .
8) Перейдём на страницу "goal" добавим цель перейдя во вкладку "update" и в ведя  сумму, которые вы хотите накопить. 
9) После чего перейдя на вкладку "Add" вы можете добавить определённую сумму денег, которую вы сэкономили благодаря нашему сервису в копилку. Если это значение больше суммы дохода, вам выдаст ошибку, ведь это означает, что вы ввели не все операции.
10) После выполнения всех вышеперечисленных действий, вернитесь обратно на главную страницу. Теперь все важные данные отображаются. 
11) Для более подробной информации перейдите на страницу "analytics" . Там у вас будет подробно отображено всё . Сперва круговые диаграммы доходов и расходов за 1, 3 и 6 месяцев. Ниже показана предположительная дата достижения цели, а под ней представлены графики:
12) График роста накопленной сумы.   
13) График соотношения доходов и расходов.
14) График предположительных расходов.
15) График предположительных доходов.
16) График предположения по бюджету.
17) График предположительной даты достижения поставленной цели .

18. При достижении поставленной суммы на главном и аналитической странице будет отображено поздравление.

20) Вы также можете выйти из аккаунта нажав кнопку "exit" в правом верхнем углу. Зайти снова или создать новый.

#### Графическое приложение инструкции выше
![Страница регистрации](https://i.ibb.co/n3RYnF5/image.png)
![Главная страница](https://i.ibb.co/KWQPgrp/image.png)
![Главная страница](https://i.ibb.co/4N9tqfW/image.png)
![Переход на страницу с транзакциями](https://i.ibb.co/5vKVPC2/image.png)
![Страница с транзакциями](https://i.ibb.co/nc8NL87/image.png)
![Заполнение полей транзакции](https://i.ibb.co/S5DstKg/image.png)
![Отображение добавленных транзакций](https://i.ibb.co/s17cqn9/image.png)
![Недостаточно данных для аналитики](https://i.ibb.co/8zGPtCm/image.png)
![Добавление транзакций на цель](https://i.ibb.co/5LCVHJb/image.png)
![Обновление цели](https://i.ibb.co/YNRGFkZ/image.png)
![Главная страница](https://i.ibb.co/QfWY66J/image.png)
![Графики категорий](https://i.ibb.co/qFwgFgm/image.png)
![Графики изменения состояния копилки и зачислений/снятий](https://i.ibb.co/pntFTY9/image.png)
![Графики доходов/расходов](https://i.ibb.co/Ky1hYjw/image.png)
![Цель достигнута](https://i.ibb.co/NFm78gs/image.png)
![Выход](https://i.ibb.co/DzNdDTw/image.png)